name: CI FOSHttpCacheBundle

env:
  SYMFONY_PHPUNIT_DIR: "$HOME/symfony-bridge/.phpunit"

on:
  push:
    branches: [ master, /^\d+\.\d+$/, hotfix/move-to-github-action ]
  pull_request:
    branches: [ master, /^\d+\.\d+$/, hotfix/move-to-github-action ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        php-versions: ['7.2', '7.3', '7.4']
        composer-flag: ['', '--prefer-stable --prefer-lowest']
        symfony-version: ['3', '4', 'dev']

    name: PHP ${{ matrix.php-versions }} Test on Symfony ${{ matrix.symfony-version }}
    steps:
      - name: Pull the code
        uses: actions/checkout@v2
      - name: Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
      - name: Check PHP Version
        run: php -v && ls -ltr
      - name: Symfony version 3 LTS
        run: composer require --no-update symfony/lts:^3
        if: ${{ matrix.symfony-version == '3' }}
      - name: Symfony version 4 LTS
        run: composer require --no-update symfony/flex && composer config extra.symfony.require ^4
        if: ${{ matrix.symfony-version == '4' }}
      - name: Symfony latest
        run: composer config minimum-stability dev
        if: ${{Â matrix.symfony-version == 'dev' }}
      - name: Composer install
        uses: php-actions/composer@v4
      - name: Composer validate
        run: composer validate --strict --no-check-lock
      - name: Composer update
        run: composer update ${{ matrix.composer-flag }} --prefer-dist --no-interaction
      - name: Install PHPUnit
        run: php vendor/bin/simple-phpunit install
      - name: Run the tests
        run: php vendor/bin/simple-phpunit -v
